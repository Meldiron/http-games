import { generate as DefaultImage } from "fumadocs-ui/og";
import { notFound } from "next/navigation";
import { ImageResponse } from "next/og";
import { getPageImage, source } from "@/lib/source";

export const revalidate = false;

export async function GET(
  _req: Request,
  { params }: RouteContext<"/og/docs/[...slug]">,
) {
  const { slug } = await params;
  const page = source.getPage(slug.slice(0, -1));
  if (!page) notFound();

  // page.data.title = 'HTTP Games';
  // page.data.description = 'Play games by sending HTTP requests. From developers, for developers.';

  const image = (
    <svg
      width="128"
      height="74"
      viewBox="0 0 128 74"
      fill="none"
      xmlns="http://www.w3.org/2000/svg"
    >
      <title style={{ opacity: 0, display: "none" }}>HTTP Games logo</title>
      <path
        d="M64.118 46.4529C57.7946 46.4529 52.6684 51.5791 52.6684 57.9025C52.6684 64.226 57.7946 69.3522 64.118 69.3522C70.4415 69.3522 75.5677 64.226 75.5677 57.9025C75.5677 51.5791 70.4415 46.4529 64.118 46.4529Z"
        fill="#2B7FFF"
      />
      <path
        d="M64.118 -4.81566e-06C57.7946 -5.36847e-06 52.6684 5.12618 52.6684 11.4496C52.6684 17.7731 57.7946 22.8993 64.118 22.8993C70.4415 22.8993 75.5677 17.7731 75.5677 11.4496C75.5677 5.12618 70.4415 -4.26284e-06 64.118 -4.81566e-06Z"
        fill="#00C951"
      />
      <path
        d="M87.3445 23.2264C81.021 23.2264 75.8948 28.3526 75.8948 34.6761C75.8948 40.9995 81.021 46.1257 87.3444 46.1257C93.6679 46.1257 98.7941 40.9996 98.7941 34.6761C98.7941 28.3526 93.6679 23.2264 87.3445 23.2264Z"
        fill="#FF8904"
      />
      <path
        d="M40.8916 23.2264C34.5681 23.2264 29.442 28.3526 29.442 34.6761C29.442 40.9995 34.5681 46.1257 40.8916 46.1257C47.2151 46.1257 52.3412 40.9996 52.3412 34.6761C52.3412 28.3526 47.2151 23.2264 40.8916 23.2264Z"
        fill="#E7000B"
      />
      <path
        d="M0 36.9999V31.1624C3.34955 31.1624 5.67293 30.4944 6.97016 29.1585C8.26738 27.8225 8.91599 25.6637 8.91599 22.6821V16.2637C8.91599 12.6818 9.40971 9.81631 10.3972 7.66717C11.404 5.49868 12.798 3.86263 14.5792 2.75902C16.3799 1.65541 18.5096 0.919673 20.9686 0.551802C23.4275 0.183934 26.1187 0 29.0423 0V9.23546C26.7577 9.23546 25.0151 9.53556 23.8147 10.1358C22.6337 10.7166 21.8302 11.6266 21.4042 12.8657C20.9782 14.0855 20.7653 15.6345 20.7653 17.5125V25.9929C20.7653 27.4644 20.4942 28.8681 19.9521 30.204C19.41 31.5206 18.4032 32.692 16.9317 33.7181C15.4602 34.7249 13.3595 35.5284 10.6295 36.1287C7.89951 36.7095 4.35635 36.9999 0 36.9999ZM29.0423 73.5061C26.1187 73.5061 23.4275 73.3222 20.9686 72.9543C18.5096 72.5865 16.3799 71.8507 14.5792 70.7471C12.798 69.6435 11.404 68.0075 10.3972 65.839C9.40971 63.6898 8.91599 60.8243 8.91599 57.2424V50.795C8.91599 47.8134 8.26738 45.6545 6.97016 44.3186C5.67293 42.9826 3.34955 42.3147 0 42.3147V36.4772C4.35635 36.4772 7.89951 36.7773 10.6295 37.3775C13.3595 37.9583 15.4602 38.7618 16.9317 39.788C18.4032 40.7948 19.41 41.9662 19.9521 43.3021C20.4942 44.6187 20.7653 46.0224 20.7653 47.5132V55.9936C20.7653 57.8523 20.9782 59.3916 21.4042 60.6113C21.8302 61.8505 22.6337 62.7605 23.8147 63.3413C25.0151 63.9415 26.7577 64.2416 29.0423 64.2416V73.5061ZM0 42.3147V31.1624H10.4262V42.3147H0Z"
        fill="white"
      />
      <path
        d="M128 36.4772V42.3147C124.67 42.3147 122.346 42.9826 121.03 44.3186C119.733 45.6545 119.084 47.8134 119.084 50.795V57.2424C119.084 60.8243 118.581 63.6898 117.574 65.839C116.586 68.0075 115.192 69.6435 113.392 70.7471C111.61 71.8507 109.49 72.5865 107.031 72.9543C104.592 73.3222 101.901 73.5061 98.9577 73.5061V64.2416C101.242 64.2416 102.975 63.9415 104.156 63.3413C105.357 62.7605 106.17 61.8505 106.596 60.6113C107.022 59.3916 107.235 57.8523 107.235 55.9936V47.5132C107.235 46.0224 107.506 44.6187 108.048 43.3021C108.59 41.9662 109.597 40.7948 111.068 39.788C112.54 38.7618 114.641 37.9583 117.371 37.3775C120.1 36.7773 123.644 36.4772 128 36.4772ZM98.9577 0C101.901 0 104.592 0.183934 107.031 0.551802C109.49 0.919673 111.61 1.65541 113.392 2.75902C115.192 3.86263 116.586 5.49868 117.574 7.66717C118.581 9.81631 119.084 12.6818 119.084 16.2637V22.6821C119.084 25.6637 119.733 27.8225 121.03 29.1585C122.346 30.4944 124.67 31.1624 128 31.1624V36.9999C123.644 36.9999 120.1 36.7095 117.371 36.1287C114.641 35.5284 112.54 34.7249 111.068 33.7181C109.597 32.692 108.59 31.5206 108.048 30.204C107.506 28.8681 107.235 27.4644 107.235 25.9929V17.5125C107.235 15.6345 107.022 14.0855 106.596 12.8657C106.17 11.6266 105.357 10.7166 104.156 10.1358C102.975 9.53556 101.242 9.23546 98.9577 9.23546V0ZM128 31.1624V42.3147H117.574V31.1624H128Z"
        fill="white"
      />
    </svg>
  );

  return new ImageResponse(
    <DefaultImage
      title={page.data.title}
      description={page.data.description}
      primaryColor="rgb(40,40,40)"
      primaryTextColor="#fff"
      icon={image}
    />,
    {
      width: 1200,
      height: 630,
    },
  );
}

export function generateStaticParams() {
  return source.getPages().map((page) => ({
    lang: page.locale,
    slug: getPageImage(page).segments,
  }));
}
